function clickImage360(n) {
  var f, t, r, u;
  $("#divPhoto360Active").contents(":not(.top-controls)").remove();
  $(n).siblings("li").removeClass("current");
  $(n).addClass("current");
  f = -10;
  $("#divPhoto360Active").hasClass("full-screen") && (f = 0);
  t = $(n).children("img");
  r = t.attr("full");
  r.indexOf("http://") == 0 && (r = r.replace("http://", "https://"));
  var s = t.attr("title"),
    h = $(n).attr("data-order"),
    e = parseInt(t.attr("top"), 0),
    o = parseInt(t.attr("bot"), 0),
    c = parseInt(t.attr("left"), 0),
    l = parseInt(t.attr("right"), 0),
    a = window.innerWidth,
    v = screen.height,
    i =
      ((2 * Math.atan((a / v) * Math.tan(((e - o) / 360) * Math.PI))) /
        Math.PI) *
      180;
  i = i > 120 ? 120 : Math.floor(i);
  i = i < 50 ? 50 : Math.floor(i);
  $("#titImg360").text(s);
  viewer = pannellum.viewer("divPhoto360Active", {
    panorama: r,
    autoLoad: !0,
    showControls: !1,
    compass: !0,
    minYaw: c,
    maxYaw: l,
    minPitch: o,
    maxPitch: e,
    maxHfov: i,
    northOffset: 0,
    orientationOnByDefault: !0,
  });
  viewer.id = "viewer" + h;
  u = !1;
  $.each(viewers, function (n, t) {
    $(t).attr("id") == viewer.id && (u = !0);
  });
  u || viewers.push(viewer);
  viewer.on("load", function () {
    $(".pnlm-compass").removeClass("pnlm-controls");
    $(".pnlm-compass").removeClass("pnlm-control");
    $(".pnlm-compass").html('<i class="icon-deg360"></i>');
    $(".pnlm-compass").after(
      '<div class="control-img360"><i class="icon-scan360"></i></div>'
    );
  });
}
function onResize(n, t) {
  var i = n.height,
    r = n.width;
  setInterval(function () {
    (n.height !== i || n.width !== r) && ((i = n.height), (r = n.width), t());
  }, 300);
}
function detectIE() {
  var n = window.navigator.userAgent,
    i = n.indexOf("MSIE "),
    u,
    r,
    t;
  return i > 0
    ? parseInt(n.substring(i + 5, n.indexOf(".", i)), 10)
    : ((u = n.indexOf("Trident/")), u > 0)
    ? ((r = n.indexOf("rv:")),
      parseInt(n.substring(r + 3, n.indexOf(".", r)), 10))
    : ((t = n.indexOf("Edge/")), t > 0)
    ? parseInt(n.substring(t + 5, n.indexOf(".", t)), 10)
    : !1;
}
var viewers = [],
  mySwipers = [],
  isTablet = !1,
  iOS = !1;
$(function () {
  var t, n;
  if (
    ((/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent) ||
      /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.platform)) &&
      ((isTablet = !0),
      (iOS = ["iPad", "iPhone", "iPod"].indexOf(navigator.platform) >= 0)),
    !isTablet &&
      ((t = '<div class="not-supported-browser">'),
      (t +=
        "TrĂ¬nh duyá»‡t báº¡n Ä‘ang sá»­ dá»¥ng khĂ´ng há»— trá»£ tĂ­nh nÄƒng nĂ y. Vui lĂ²ng nĂ¢ng cáº¥p lĂªn phiĂªn báº£n má»›i nháº¥t Ä‘á»ƒ xem Ä‘Æ°á»£c áº£nh 360."),
      (t += "</div>"),
      (n = detectIE()),
      n && n < 10))
  ) {
    $("#titImg360").before(t);
    return;
  }
  if (((n = detectIE()), n && n < 10)) {
    $("#titImg360").before(t);
    return;
  }
  $("#divPhoto360Active").length != 0 &&
    ($("#divPhoto360Active .top-controls").append(
      '<div class="control-popup360"><span class="prev-thumb360"></span><div class="thumb-img360 swiper-container"><ul class="list-thumb360 swiper-wrapper">' +
        $("#photo360 .list-img ul.thumbs360").html() +
        '</ul></div><span class="next-thumb360"></span></div>'
    ),
    $(".thumbs360 li").bind("click", this, function () {
      var t = $(this).siblings("li.current"),
        n;
      t.length &&
        ((n = $(this).attr("data-order")),
        $("#divPhoto360Active .list-thumb360 li").each(function (t, i) {
          if ($(i).attr("data-order") == n)
            return (
              $(i).siblings("li").removeClass("current"),
              $(i).addClass("current"),
              !1
            );
        }));
      clickImage360(this);
    }),
    document.getElementById("pan-up").addEventListener("click", function () {
      viewer.stopAutoRotate();
      viewer.setPitch(viewer.getPitch() + 10);
    }),
    document.getElementById("pan-down").addEventListener("click", function () {
      viewer.stopAutoRotate();
      viewer.setPitch(viewer.getPitch() - 10);
    }),
    document.getElementById("pan-left").addEventListener("click", function () {
      viewer.stopAutoRotate();
      viewer.setYaw(viewer.getYaw() - 10);
    }),
    document.getElementById("pan-right").addEventListener("click", function () {
      viewer.stopAutoRotate();
      viewer.setYaw(viewer.getYaw() + 10);
    }),
    document.getElementById("zoom-in").addEventListener("click", function () {
      viewer.stopAutoRotate();
      viewer.setHfov(viewer.getHfov() - 10);
    }),
    document.getElementById("zoom-out").addEventListener("click", function () {
      viewer.stopAutoRotate();
      viewer.setHfov(viewer.getHfov() + 10);
    }),
    document
      .getElementById("auto-rotate")
      .addEventListener("click", function () {
        var n = viewer.getConfig();
        n && n.autoRotate
          ? viewer.stopAutoRotate()
          : viewer.startAutoRotate(-5);
      }),
    document
      .getElementById("fullscreen")
      .addEventListener("click", function () {
        if (
          ($.each(viewers, function (n, t) {
            t.toggleFullscreen();
          }),
          $("#divPhoto360Active .pnlm-render-container canvas").length)
        ) {
          var n = $("#divPhoto360Active .pnlm-render-container canvas")[0];
          onResize(n, function () {
            n.width === window.innerWidth && n.height === window.innerHeight
              ? $("#divPhoto360Active").addClass("full-screen")
              : $("#divPhoto360Active").removeClass("full-screen");
          });
        }
      }),
    document
      .getElementById("btnCloseFullscreen")
      .addEventListener("click", function () {
        $.each(viewers, function (n, t) {
          t.toggleFullscreen();
        });
        $("#divPhoto360Active").removeClass("full-screen");
      }));
});
