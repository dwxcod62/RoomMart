function checkCardConfig(n, t) {
    var i = t,
        r = n.height();
    r > 26 && (r = n.height(), i -= 1, n.find(`.js__card-config-item:nth-child(${t})`).hide(), n.find(`.js__card-config-item:nth-child(${t})`).html() != "·" && (n.find(`.js__card-config-item:nth-child(${i})`).hide(), i -= 1), checkCardConfig(n, i))
}
window.FrontEnd || (window.FrontEnd = {});
FrontEnd.CardController = function(n, t = false) {
    let r = "/Product/ProductDetail/DecryptPhone";
    waitObject("urlServices").then(() => {
        r = window.urlServices.kongGwConvertUrl("/Product/ProductDetail/DecryptPhone")
    });
    var i;
    (function() {
        var u = new window.FrontEnd.MarkingProductsServices,
            e, f;
        $("body .btn-phone--lazy-loading").removeClass("btn-phone--lazy-loading");
        n || (n = $(`.js__card`));
        n.length > 0 && (t || n.parents(".js__srp-list").length > 0 && (n = n.parents(".js__srp-list").children().not(".promoted-ads-appearance")), FrontEnd.MarkingProductsServices && (u.GetMarkedProducts().then(function(t) {
            n.find(`.js__marking-product`).each(function(n, i) {
                var r = $(i).data("marked-product-info-as-json"),
                    u;
                r.documentId != undefined && r.documentId != null ? t.filter(n => n.documentId == r.documentId).length || t.filter(n => n.productId == r.productId && (n.documentId == undefined || n.documentId == null)).length ? ($(i).addClass(cm.GetStyleClass("pressed")), $(i).attr("aria-label", "Bấm để bỏ lưu tin"), $(i).attr("tracking-label") && $(i).attr("tracking-label", `${$(i).attr("tracking-label")},status=unsave`)) : $(i).attr("tracking-label") && $(i).attr("tracking-label", `${$(i).attr("tracking-label")},status=save`) : (u = r.productId, t.filter(n => n.productId == u).length ? ($(i).addClass(cm.GetStyleClass("pressed")), $(i).attr("aria-label", "Bấm để bỏ lưu tin"), $(i).attr("tracking-label") && $(i).attr("tracking-label", `${$(i).attr("tracking-label")},status=unsave`)) : $(i).attr("tracking-label") && $(i).attr("tracking-label", `${$(i).attr("tracking-label")},status=save`))
            })
        }), n.find(`.js__marking-product`).click(function(t) {
            t.stopPropagation();
            t.preventDefault();
            var r = $(this),
                i = r.data("marked-product-info-as-json");
            i.documentId != undefined ? u.MarkOrUnmarkProduct(i).then(function(n) {
                var t;
                if ($btns = $(`[data-marked-product-info-as-json*="${i.documentId}"]`), r.closest(".js__card").hasClass("js__card-wap") ? (actionMarkingProductWapPixiu("pressed", i.documentId, n), r.closest(".js__list-history").length > 0 && (n.marked ? ($(".js__marking-product-details").addClass(cm.GetStyleClass("state-icon--actived")), $(".js__marking-product-details").find(".text").html("Đã lưu tin")) : ($(".js__marking-product-details").removeClass(cm.GetStyleClass("state-icon--actived")), $(".js__marking-product-details").find(".text").html("Lưu tin")))) : (n.marked ? ($btns.addClass(cm.GetStyleClass("pressed")), $btns.attr("aria-label", "Bấm để bỏ lưu tin")) : ($btns.removeClass(cm.GetStyleClass("pressed")), $btns.attr("aria-label", "Bấm để lưu tin")), menu.UpdateMarkedProductsCount(), menu.ShowMarkedProductsPopup(), menu.ShowMarkedProductsNoti(n.marked)), n.marked)
                    for (t = 0; t < $btns.length; t++) $btn = $($btns[t]), $btn.attr("tracking-label") && $btn.attr("tracking-label", `${($btn.attr("tracking-label")+"").replace(",status=save","")},status=unsave`);
                else
                    for (t = 0; t < $btns.length; t++) $btn = $($btns[t]), $btn.attr("tracking-label") && $btn.attr("tracking-label", `${($btn.attr("tracking-label")+"").replace(",status=unsave","")},status=save`)
            }) : u.MarkOrUnmarkProduct(i).then(function(t) {
                var r;
                if ($btns = $(`[data-marked-product-info-as-json*=":${i.productId},"]`), n.hasClass("js__card-wap") ? (actionMarkingProductWap("pressed", i.productId, t), n.closest(".js__list-history").length > 0 && (t.marked ? ($(".js__marking-product-details").addClass(cm.GetStyleClass("state-icon--actived")), $(".js__marking-product-details").find(".text").html("Đã lưu tin")) : ($(".js__marking-product-details").removeClass(cm.GetStyleClass("state-icon--actived")), $(".js__marking-product-details").find(".text").html("Lưu tin")))) : (t.marked ? ($btns.addClass(cm.GetStyleClass("pressed")), $btns.attr("aria-label", "Bấm để bỏ lưu tin")) : ($btns.removeClass(cm.GetStyleClass("pressed")), $btns.attr("aria-label", "Bấm để lưu tin")), menu.UpdateMarkedProductsCount(), menu.ShowMarkedProductsPopup(), menu.ShowMarkedProductsNoti(t.marked)), t.marked)
                    for (r = 0; r < $btns.length; r++) $btn = $($btns[r]), $btn.attr("tracking-label") && $btn.attr("tracking-label", `${($btn.attr("tracking-label")+"").replace(",status=save","")},status=unsave`);
                else
                    for (r = 0; r < $btns.length; r++) $btn = $($btns[r]), $btn.attr("tracking-label") && $btn.attr("tracking-label", `${($btn.attr("tracking-label")+"").replace(",status=unsave","")},status=save`)
            })
        })));
        n.find(".js__card-config").each(function() {
            checkCardConfig($(this), $(this).find(".js__card-config-item").length)
        });
        n.find(`.js__card-phone-btn`).click(function(t) {
            t.preventDefault();
            cm.SetSessionKeyHiddenMobile();
            var u = $(this),
                i = u.attr("prid"),
                f = {
                    elementSelector: `.js__card-phone-btn[prid="${i}"]`,
                    triggerType: "clickPhone",
                    name: $(this).data("kyc-name"),
                    avatar: $(this).data("kyc-avatar"),
                    messageType: 2,
                    triggerPage: $(".js__current-page").data("page-load") ? +$(".js__current-page").data("page-load") : +$(".js__current-page").val(),
                    triggerPositionTop: $(`.js__card-phone-btn[prid="${i}"]`).closest(".js__card").position().top,
                    triggerViewMore: $(".js__kyc-product-view-more").length > 0 ? $(".js__kyc-product-view-more").attr("class").search("on") >= 0 ? "js__kyc-product-extend" : "" : "",
                    triggerPositionLazyload: $(".js__box-product-lazyload").length > 0 ? $(".js__box-product-lazyload").position().top : 0,
                    elementId: i
                };
            (f.triggerPage == 0 || n.hasClass("js__card-full-web")) && (f.triggerPage = 1);
            $("#interestedProductsBinnovaContent").length > 0 && (f.triggerPage = $(".js__kyc-product-view-more").attr("class").search("on") >= 0 ? 2 : 0),
                function e() {
                    if (window.FrontEnd && window.FrontEnd.KycFormHelper) {
                        let n = new window.FrontEnd.KycFormHelper;
                        n.OpenLoginGateForm(f).then(n => {
                            var t, f, o, e;
                            if (n)
                                if ($(u).attr("data-click", !0), t = u, f = t.attr("raw"), $(t).hasClass(`${cm.GetStyleClass("show-phone")}`) == !1) o = {
                                    type: "POST",
                                    url: r,
                                    data: {
                                        PhoneNumber: f
                                    },
                                    success: function(n) {
                                        if (n != undefined && n.length > 0) {
                                            if (t.attr("mobile", n), t.closest(`.js__card`).find(".hidden-mobile").each(function() {
                                                    $(u).attr("raw") == f && ($(u).html(n), $(u).attr("mobile", n))
                                                }), cm.CopyTextToClipboard(n), window.SegmentClient && i && window.SegmentClient.LeadPhone(i), !$(u).hasClass("re__show-phone") && window.FrontEnd && window.FrontEnd.LeadManagementServices) {
                                                var r = 20;
                                                (function e() {
                                                    --r;
                                                    window.userServices ? window.userServices.getCurrentUserInfo(function(n) {
                                                        var t, r, u;
                                                        if (n) {
                                                            let f = new window.FrontEnd.LeadManagementServices;
                                                            t = f.LeadSourcePage.BDS_SEARCH_RESULT_PAGE;
                                                            r = $(`.js__card-phone-btn[prid="${i}"]`).attr("tracking-label").toLowerCase();
                                                            r.includes("home") && (t = f.LeadSourcePage.BDS_HOME_PAGE);
                                                            r.includes("marking-product") && (t = f.LeadSourcePage.BDS_SAVED_LISTINGS_PAGE);
                                                            u = {
                                                                userId: n.userId,
                                                                mobile: n.mobile,
                                                                sellerId: $(`.js__card-phone-btn[prid="${i}"]`).attr("uid"),
                                                                productId: i,
                                                                productType: 0,
                                                                leadSourcePage: t,
                                                                leadSourceAction: f.LeadSourceAction.PHONE_REVEAL,
                                                                fromLeadType: f.FromLeadType.PhoneReveal
                                                            };
                                                            f.CreateLead(u)
                                                        }
                                                    }) : r >= 0 && setTimeout(e, 100)
                                                })()
                                            }
                                            t.closest(`.js__card`).hasClass("js__card-full-web") ? (t.closest(`.js__card`).find(".js__product-link-for-product-id").attr("title", cm.FormartTagHtml(t.closest(`.js__card`).find(".js__card-title").html())), t.addClass(`${cm.GetStyleClass("show-phone")}`), t.html().indexOf("Sao chép") >= 0 ? window.location.href = "tel:" + n : (t.closest(`.js__card`).find("a").attr("title", t.closest(`.js__card`).find(`.js__card-title`).text().replace(/(?:\r\n|\r|\n)/g, " ").trim()), t.html('<i class="' + cm.GetStyleClass("icon-phone-call--sm") + '"><\/i><span>' + n + " · Sao chép<\/span>")), cm.ShowToolTip(t, "Đã sao chép", "tooltip-text-only")) : (t.addClass(`${cm.GetStyleClass("show-phone")}`), t.html('<i class="' + cm.GetStyleClass("icon-phone-call--sm") + '"><\/i><span>' + n + "<\/span>"), cm.ShowToolTip(t, "Đã sao chép", "tooltip-text-only"));
                                            t.closest(`.js__card`).hasClass("js__card-full-web") || (window.location.href = "tel:" + n)
                                        }
                                    }
                                }, cm.AjaxWrapper(o);
                                else return e = t.attr("mobile"), cm.CopyTextToClipboard(e), cm.ShowToolTip(t, "Đã sao chép", "tooltip-text-only"), window.location.href = "tel:" + e, !1
                        })
                    } else setTimeout(e, 500)
                }()
        });
        FrontEnd.BadReportProductsServices && (n.hasClass("js__card-wap") ? (i = new FrontEnd.BadReportProductsServices, i.GetBadReportProductsFromLocal().then(function(t) {
            n.each(function(n, i) {
                var r = $(i).attr("prid"),
                    u;
                t.filter(n => n.productId == r).length && (u = t.filter(n => n.productId == r)[0], $(i).addClass(cm.GetStyleClass("disabled")), $(i).append(`
                                        <a href="javascript:void(0);" class="${cm.GetStyleClass("report")} js__card-report">
                                            <h3 class="${cm.GetStyleClass("card-title")}">
                                                <span class="${cm.GetStyleClass("label-solid-black-opacity--sm")}">
                                                    <i class="${cm.GetStyleClass("icon-item-hide--sm")}"></i>
                                                    <span>Tin đã ẩn</span>
                                                </span>
                                                <span class="${cm.GetStyleClass("title")}">${$(i).find(`.js__card-title-full`).html()}</span>
                                            </h3>
                                            <p class="js__report-reason ${cm.GetStyleClass("report-reason")}">Lý do: ${u.note}</p>
                                            <div class="${cm.GetStyleClass("report-action")}">
                                                <span class="${cm.GetStyleClass("time")}">
                                                    ${new Date(u.saveTime).ToDurationTimeFromNow("báo xấu")}
                                                </span>
                                                <span data-product-id="${r}" class="js__unreport ${cm.GetStyleClass("btn","btn-se-border--sm")}" product-id="">
                                                    Mở lại tin đăng
                                                </span>
                                            </div>
                                        </a>`))
            });
            n.find(`.js__unreport`).click(function() {
                var n = $(this).closest(".js__card"),
                    t = +n.attr("prid");
                i.BadReportOrUnBadReportProduct(t, "", "").then(function() {
                    n.removeClass(cm.GetStyleClass("disabled"));
                    n.find(".js__card-report").remove();
                    $(`.js__card[prid="${t}"]`).removeClass(cm.GetStyleClass("disabled"));
                    $(`.js__card[prid="${t}"]`).find(".js__card-report").remove()
                })
            })
        })) : n.hasClass("js__card-full-web") ? (i = new FrontEnd.BadReportProductsServices, i.GetBadReportProductsFromLocal().then(function(t) {
            n.find(`.js__product-link-for-product-id`).each(function(n, i) {
                var r = $(i).data("product-id"),
                    u;
                t.filter(n => n.productId == r).length && (u = t.filter(n => n.productId == r)[0], $(i).parent().addClass(cm.GetStyleClass("card-bad-requested-product")), $(i).after(`
                                        <a class="js__bad-reported-product-content-for-id-${r}">
                                            <div class="${cm.GetStyleClass("card-info")}">
                                                <div class="${cm.GetStyleClass("card-info-content")}">
                                                    <h3 class="${cm.GetStyleClass("card-title")}">
                                                        <span>
                                                            <div class="${cm.GetStyleClass("label-solid-black-opacity--sm")}">
                                                                <i class="${cm.GetStyleClass("icon-item-hide--sm")}"></i>
                                                                <span>Tin đã ẩn</span>
                                                            </div>
                                                            ${$(i).find(`[product-title]`).html()}
                                                        </span>
                                                    </h3>
                                                    <div class="${cm.GetStyleClass("card-description")}">
                                                        Lý do: ${u.note}
                                                    </div>
                                                    <div class="${cm.GetStyleClass("card-contact")}">
                                                        <div class="${cm.GetStyleClass("card-published-info")}">
                                                        <span class="${cm.GetStyleClass("card-published-info-published-at")}">
                                                                ${new Date(u.saveTime).ToDurationTimeFromNow("báo xấu")}
                                                            </span>
                                                        </div>
                                                        <div class="${cm.GetStyleClass("card-contact-button")}">
                                                        <span data-product-id="${r}" class="js__re-open-product ${cm.GetStyleClass("btn","btn-se-border--sm")}">
                                                                <span>Mở lại tin đăng</span>
                                                            </span>
                                                        </div>
                                                        <div style="clear:left"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </a>`))
            });
            n.find(`.js__re-open-product`).click(function() {
                var n = +$(this).data("product-id");
                i.BadReportOrUnBadReportProduct(n, "", "").then(function() {
                    $(`.js__bad-reported-product-content-for-id-${n}`).parent().removeClass(cm.GetStyleClass("card-bad-requested-product"));
                    $(`.js__bad-reported-product-content-for-id-${n}`).remove()
                })
            })
        })) : n.hasClass("js__card-compact-web") && (i = new FrontEnd.BadReportProductsServices, i.GetBadReportProductsFromLocal().then(function(t) {
            n.find(`.js__product-link-for-product-id`).each(function(n, i) {
                var r = $(i).data("product-id"),
                    u;
                t.filter(n => n.productId == r).length && (u = t.filter(n => n.productId == r)[0], $(i).parent().addClass(cm.GetStyleClass("card-bad-requested-product")), $(i).after(`
                                        <div class="js__bad-reported-product-content-for-id-${r}">
                                            <div>
                                                <div>
                                                    <div class="${cm.GetStyleClass("label-solid-black-opacity--md")}">
                                                        <i class="${cm.GetStyleClass("icon-item-hide--sm")}"></i>
                                                        <span>Tin đã ẩn</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div>
                                                <span>
                                                    Lý do: ${u.note}
                                                </span>
                                                <span class="js__re-open-product ${cm.GetStyleClass("btn","btn-se-border--sm")}" data-product-id="${r}">Mở lại tin</span>
                                            </div>
                                        </div>`))
            });
            n.find(`.js__re-open-product`).click(function() {
                var n = +$(this).data("product-id");
                i.BadReportOrUnBadReportProduct(n, "", "").then(function() {
                    $(`.js__bad-reported-product-content-for-id-${n}`).parent().removeClass(cm.GetStyleClass("card-bad-requested-product"));
                    $(`.js__bad-reported-product-content-for-id-${n}`).remove()
                })
            })
        })));
        $(`[avatar-slide="true"]`).hover(function() {
            var r = $(this).find("img[data-listing]").data("listing"),
                n, u;
            if (r && r.length > 0 && (n = r.split(","), u = n.length, u > 0)) {
                var o = !1,
                    t = 0,
                    i = $(this).find("img[data-listing]");

                function r() {
                    i.animate({
                        opacity: 1
                    }, function() {
                        i.attr("src", n[t])
                    });
                    t++;
                    t >= n.length && (t = 0);
                    i.animate({
                        opacity: 1
                    });
                    clearTimeout(f)
                }

                function s() {
                    i.attr("src", n[u - 1])
                }
                o || (f = setTimeout(s, 500), o = !0);
                e = setInterval(r, 1500)
            }
        }, function() {
            clearInterval(e);
            clearTimeout(f);
            var n = $(this).find(".product-avatar-img"),
                t = n.data("img");
            n.attr("src", t)
        })
    })()
};
$(window).resize(function() {
    $(".js__card-config-item").removeAttr("style");
    $(`.js__card`).find(".js__card-config").each(function() {
        checkCardConfig($(this), $(this).find(".js__card-config-item").length)
    })
});