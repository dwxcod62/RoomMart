var menu = {};
(function(n) {
    n.Menu = function() {
        function c() {
            $(`.${n.GetStyleClass("dropdown-navigative-menu")}`).find("li.lv1").mouseover(function() {
                if ($(this).offset().left + 220 + 220 > $(document.body).width()) $(this).find("ul").each(function() {
                    $(this).css("left", "-" + $(this).width() + "px")
                });
                else {
                    var n = $(this).width() + 20;
                    $(this).find("ul").each(function() {
                        $(this).css("left", n + "px")
                    })
                }
            });
            l();
            $(document).ready(function() {
                $(".lv0 ul, .lv1 ul, .lv2 ul").not(":has(li)").remove();
                $(".lv0, .lv1, .lv2").each(function() {
                    $(this).children("ul").length && $(this).children("a").after(`<div class="${n.GetStyleClass("arrrow")}"></div>`)
                });
                $("#nav_list").click(function() {
                    $(`.${n.GetStyleClass("menu-bar")}`).addClass("in");
                    $(`.${n.GetStyleClass("bg-pushmenu")}`).addClass("in");
                    $(this).addClass("in");
                    $("body").addClass(`${n.GetStyleClass("pushmenu-push")} in`);
                    window.LiveChatWidget && LiveChatWidget.call("hide");
                    $(".search-bar").hasClass("fix") && $(".js__pr-scrollbar").addClass("hidden")
                });
                $("#nav_back").click(function() {
                    var r = $("#staticDomain").data("domainorigin"),
                        n;
                    if (document.referrer.search(r) == -1) {
                        var f = location.href.split(r)[1],
                            t = $(".breadcrumb a").length,
                            u = "/",
                            i = "";
                        if (t > 0)
                            for (n = 0; n < t; n++)
                                if (i = $('.breadcrumb a[level="' + (t - n) + '"]').attr("href") ? $('.breadcrumb a[level="' + (t - n) + '"]').attr("href") : $('.breadcrumb a[level="' + (t - n) + '"]').attr("hidden-href"), f != i) {
                                    u = i;
                                    break
                                }
                        window.location = u
                    } else window.history.back()
                });
                $(`.${n.GetStyleClass("dropdown-navigative-menu")} li .${n.GetStyleClass("arrrow")}`).click(function() {
                    var i = $(this).closest(`.${n.GetStyleClass("full-menu")}`).attr("class"),
                        t;
                    i.search(`tablet-menu`) >= 0 && (t = $(this).closest(".lv0"), t.hasClass(`${n.GetStyleClass("actived")}`) ? t.removeClass(`${n.GetStyleClass("actived")}`) : ($(`.${n.GetStyleClass("full-menu")} .lv0`).removeClass(`${n.GetStyleClass("actived")}`), t.addClass(`${n.GetStyleClass("actived")}`)))
                });
                $(`.nolink`).click(function() {
                    $(this).parent().find(`.${n.GetStyleClass("arrrow")}`).trigger("click")
                });
                $(`.${n.GetStyleClass("bg-pushmenu")}`).click(function() {
                    window.LiveChatWidget && LiveChatWidget.call("hide");
                    $(`.${n.GetStyleClass("pushmenu-right")}`).removeClass("in");
                    $(`.${n.GetStyleClass("bg-pushmenu")}`).removeClass("in");
                    $("#nav_list").addClass("in");
                    $("body").removeClass(`${n.GetStyleClass("pushmenu-push")} in`);
                    $(".search-bar").hasClass("fix") && setTimeout(function() {
                        $(".search-bar .search-bar-input.fix").show();
                        $(".search-bar").show();
                        $(".js__pr-scrollbar").removeClass("hidden")
                    }, 150)
                });
                $(document).on("click", ".livechatwidget", function() {
                    !window.LiveChatWidget && window.initLiveChat && initLiveChat();
                    LiveChatWidget.call("maximize")
                });
                $(window).scroll(function() {
                    var i, u, e, r;
                    if (window.location.pathname == "/" && ($(".ui-autocomplete").hide(), $(".box-header.fix .header-logo").show()), i = $(window).scrollTop(), u = window.innerWidth, u > 1128 && u <= 1280) {
                        if ($(".js__pr-scrollbar").length) return;
                        r = 50;
                        i >= r ? ($(".search-bar").addClass("fix"), $(".select-control.project-control").attr("data-microtip-position", "bottom"), $(".filter-control .select-control-label").attr("data-microtip-position", "bottom"), $(`.${n.GetStyleClass("iconNotiSave")}`).attr("class", $(`.${n.GetStyleClass("iconNotiSave")}`).attr("class").split("--md").join("--sm")), $(`.js__avatar`).length > 0 && $(`.js__avatar`).attr("class", $(`.js__avatar`).attr("class").split("--xl").join("--lg")), t($("#kct_login"), !0), t($("#kct_username"), !0), t($("#linkPostProduct"), !0), $(".line").css("margin", "7px 0")) : ($(".search-bar").removeClass("fix"), $(".select-control.project-control").attr("data-microtip-position", "top"), $(".filter-control .select-control-label").attr("data-microtip-position", "top"), $(`.${n.GetStyleClass("iconNotiSave")}`).attr("class", $(`.${n.GetStyleClass("iconNotiSave")}`).attr("class").split("--sm").join("--md")), $(`.js__avatar`).length > 0 && $(`.js__avatar`).attr("class", $(`.js__avatar`).attr("class").split("--lg").join("--xl")), t($("#kct_login"), !1), t($("#kct_username"), !1), t($("#linkPostProduct"), !1), $(".line").removeAttr("style"));
                        s(i, r);
                        $(".text-new-content").removeClass("text-new-content-wap");
                        f(u, i, r)
                    } else if (u <= 1128)
                        if ($(".re__pr-navigation-ldp").length) i > 150 ? ($(`.${n.GetStyleClass("bg-header")}`).hide("fade", 500), $(".js__pr-scrollbar").show("fade", 500)) : ($(`.${n.GetStyleClass("bg-header")}`).show("fade", 500), $(".js__pr-scrollbar").hide("fade", 500));
                        else {
                            if ($(".select-control.project-control").attr("data-microtip-position", "top"), $(".filter-control .select-control-label").attr("data-microtip-position", "top"), e = 64, i > e) {
                                if ($(`.${n.GetStyleClass("bg-pushmenu")}`).hasClass("in")) {
                                    $("#top-bar").length && $("#top-bar").addClass("hidden");
                                    return
                                }
                                $(".main-container").addClass("fix");
                                $(".box-header").addClass("fix");
                                $(".search-bar").addClass("fix");
                                $(".ui-autocomplete").addClass("fix");
                                $("#boxSearchForm").addClass("fix")
                            } else {
                                if ($(`.${n.GetStyleClass("bg-pushmenu")}`).hasClass("in")) return;
                                $(".main-container").removeClass("fix");
                                $(".box-header").removeClass("fix");
                                $(".search-bar").removeClass("fix");
                                $(".search-bar-input").removeClass("fix");
                                $(".ui-autocomplete").removeClass("fix");
                                $(".ui-autocomplete").css("top", "166px");
                                $("#boxSearchForm").removeClass("fix")
                            }
                            $(".text-new-content").removeClass("text-new-content-top");
                            $(".text-new-content").addClass("text-new-content-wap");
                            f(u, i, e - 1)
                        }
                    else {
                        if ($(".js__pr-scrollbar").length) return;
                        r = 20;
                        i >= r ? ($(".main-container").addClass("fix"), $(".site-center").addClass("fix"), $(".search-bar").addClass("fix"), $(".ui-autocomplete").addClass("fix"), $(".select-control.project-control").attr("data-microtip-position", "bottom"), $(".filter-control .select-control-label").attr("data-microtip-position", "bottom"), $(`.${n.GetStyleClass("iconNotiSave")}`).find(`.${n.GetStyleClass("icon-heart")}`).attr("class", n.GetStyleClass("icon-heart--sm")), $(`.${n.GetStyleClass("iconNotiSave")}`).attr("class", $(`.${n.GetStyleClass("iconNotiSave")}`).attr("class").split("--md").join("--sm")), $(`.js__avatar`).length > 0 && $(`.js__avatar`).attr("class", $(`.js__avatar`).attr("class").split("--xl").join("--lg")), t($("#kct_login"), !0), t($("#kct_username"), !0), t($("#linkPostProduct"), !0), $(".line").css("margin", "7px 0")) : ($(".main-container").removeClass("fix"), $(".site-center").removeClass("fix"), $(".search-bar").removeClass("fix"), $(".ui-autocomplete").removeClass("fix"), $(".select-control.project-control").attr("data-microtip-position", "top"), $(".filter-control .select-control-label").attr("data-microtip-position", "top"), $(`.${n.GetStyleClass("iconNotiSave")}`).find(`.${n.GetStyleClass("icon-heart--sm")}`).attr("class", n.GetStyleClass("icon-heart")), $(`.${n.GetStyleClass("iconNotiSave")}`).attr("class", $(`.${n.GetStyleClass("iconNotiSave")}`).attr("class").split("--sm").join("--md")), $(`.js__avatar`).length > 0 && $(`.js__avatar`).attr("class", $(`.js__avatar`).attr("class").split("--lg").join("--xl")), t($("#kct_login"), !1), t($("#kct_username"), !1), t($("#linkPostProduct"), !1), $(".line").removeAttr("style"));
                        s(i, r);
                        $(".text-new-content").removeClass("text-new-content-wap");
                        f(u, i, r)
                    }
                    $("#notiSave") && $("#notiSave").children(`div.${n.GetStyleClass("marked-products-popup")}[style="display: none;"]`) && $("#notiSave").children(`div.${n.GetStyleClass("marked-products-popup")}`).hide()
                })
            });
            i.GetMarkedProducts().then(t => {
                var i = $("body").width();
                $(window).resize(function() {
                    i = $("body").width()
                });
                i > 1128 ? $(`#notiSave .${n.GetStyleClass("nqv")}`).length > 0 && ($(`#notiSave .${n.GetStyleClass("nqv")}`).html(t.length), t.length ? $(`#notiSave .${n.GetStyleClass("nqv")}`).show() : $(`#notiSave .${n.GetStyleClass("nqv")}`).hide()) : $(`#saveList .${n.GetStyleClass("notification")}`).length > 0 && ($(`#saveList .${n.GetStyleClass("notification")}`).html(t.length), t.length ? $(`#saveList .${n.GetStyleClass("notification")}`).removeClass(`${n.GetStyleClass("hide")}`) : $(`#saveList .${n.GetStyleClass("notification")}`).addClass(`${n.GetStyleClass("hide")}`))
            });
            $("#notiSave").click(function(t) {
                h();
                $(`.${n.GetStyleClass("marked-products-popup")}[style="display: none;"]`).length != 0 || $(t.toElement).hasClass(`${n.GetStyleClass("ic_save")}`) || $(t.target).parents().hasClass(`${n.GetStyleClass("marked-products-popup")}`) || $(t.target).parent().hasClass(`${n.GetStyleClass("item")}`) ? (o(), $(this).children(`div.${n.GetStyleClass("marked-products-popup")}`).show(), $(this).children("img").addClass(`${n.GetStyleClass("actived")}`), $("body").unbind(), $("body").bind("click", $("#notiSave"), function(t) {
                    $(t.target).parents().hasClass(`${n.GetStyleClass("marked-products-popup")}`) || $(t.target).hasClass(`${n.GetStyleClass("mnu-notify-icon-unread")}`) || $(t.target).hasClass(`${n.GetStyleClass("iconNotiSave")}`) || $(t.target).parent().hasClass(`${n.GetStyleClass("item")}`) || $(t.target).parent().hasClass(`${n.GetStyleClass("iconNotiSave")}`) || ($(`.${n.GetStyleClass("marked-products-popup")}`).hide(), $(`#notiSave .${n.GetStyleClass("iconNotiSave")}`).removeClass("actived"))
                })) : ($(this).children(`div.${n.GetStyleClass("marked-products-popup")}`).hide(), $(this).children("img").removeClass(`${n.GetStyleClass("actived")}`))
            });
            var e = 400,
                r;
            $(`.${n.GetStyleClass("dropdown-navigative-menu")} li.lv0`).hover(function(t) {
                var i = $(this).closest(`.${n.GetStyleClass("full-menu")}`).attr("class");
                i.search(`hover-menu`) >= 0 && (r = setTimeout(function() {
                    $(t.currentTarget).children("ul").css("display", "block")
                }, e))
            }, function(t) {
                var i = $(this).closest(`.${n.GetStyleClass("full-menu")}`).attr("class");
                i.search(`hover-menu`) >= 0 && ($(t.currentTarget).parent().hasClass("lv0") || $(`.${n.GetStyleClass("hover-menu")} .${n.GetStyleClass("dropdown-navigative-menu")} li.lv0`).children("ul").css("display", "none"), clearTimeout(r))
            });
            $(window).resize(function() {
                u()
            });
            ResponsiveSizeScreen()
        }

        function t(n, t) {
            t ? n.attr("class") && n.attr("class", n.attr("class").split("--md").join("--sm")) : n.attr("class") && n.attr("class", n.attr("class").split("--sm").join("--md"))
        }

        function l() {
            var i = $(`.${n.GetStyleClass("btn-menu")} .${n.GetStyleClass("bg")}`).html(),
                t;
            i.length > 0 || (t = "", $(`.${n.GetStyleClass("phong-thuy")}`).length && (t += `<li class="lvb">` + $(`.${n.GetStyleClass("phong-thuy")}`).html() + `<span class="${n.GetStyleClass("arrrow")}"></span></li>`), $(`.${n.GetStyleClass("noi-ngoai-that")}`).length && (t += `<li class="lvb">` + $(`.${n.GetStyleClass("noi-ngoai-that")}`).html() + `<span class="${n.GetStyleClass("arrrow")}"></span></li>`), $(`.${n.GetStyleClass("phan-tich-danh-gia")}`).length && (t += `<li class="lvb">` + $(`.${n.GetStyleClass("phan-tich-danh-gia")}`).html() + `<span class="${n.GetStyleClass("arrrow")}"></span></li>`), $(`.${n.GetStyleClass("danh-ba")}`).length && (t += `<li class="lvb">` + $(`.${n.GetStyleClass("danh-ba")}`).html() + `<span class="${n.GetStyleClass("arrrow")}"></span></li>`), $(`.${n.GetStyleClass("btn-menu")} .${n.GetStyleClass("bg")}`).html(t))
        }

        function a() {
            h();
            o();
            $(`div.${n.GetStyleClass("marked-products-popup")}`).show();
            $(`#notiSave .${n.GetStyleClass("iconNotiSave")}`).addClass("actived");
            $("body").unbind();
            $("body").bind("click", $(".js__marking-product"), function(t) {
                $(t.target).hasClass("js__marking-product") || !$(t.target).parent() || $(t.target).parent().hasClass("js__marking-product") || ($(`.${n.GetStyleClass("marked-products-popup")}`).hide(), $(`#notiSave .${n.GetStyleClass("iconNotiSave")}`).removeClass("actived"))
            })
        }

        function v(n) {
            var i = $("body").width(),
                t;
            i <= 1128 && (t = n ? ".popupMarking.save" : ".popupMarking.unsave", y($(t)))
        }

        function y(n) {
            n.css("display", "block").animate({
                opacity: "1"
            }, 500, "easeInOutQuint").delay(500).animate({
                opacity: "0"
            }, 1200, "easeInOutQuint", function() {
                $(this).css("display", "none")
            })
        }

        function o() {
            i.GetNotificationObjects().then(t => {
                var f, s, o;
                if ($(`.${n.GetStyleClass("marked-products-popup")} .${n.GetStyleClass("content")}`).remove(), $(`.${n.GetStyleClass("marked-products-popup")} .${n.GetStyleClass("header")}`).after(`<div class="${n.GetStyleClass("content")}"></div>`), f = $(`.${n.GetStyleClass("marked-products-popup")} .${n.GetStyleClass("content")}`), t.length > 0) {
                    for ($(`.${n.GetStyleClass("marked-products-popup")} .${n.GetStyleClass("footer")}`).show(), f.html(""), s = e > t.length ? t.length : e, o = 0; o < s; o++) {
                        var r = t[o],
                            c = r.titleHiddenMobile ? n.FormartTagHtml(r.titleHiddenMobile.replace(/q&uot/g, '"').replace(/#&39/g, "'")) : detectTelNumberNewFromHtml(n.FormartTagHtml(r.title.replace(/q&uot/g, '"').replace(/#&39/g, "'")), !0, "", !0),
                            h = w(r.avatarinfowap);
                        f.append(`
                            <div class="${n.GetStyleClass("item")}">
                                <a href="${r.url}" documentId="${r.documentId}" prid="${r.productId}" vtp="${r.vipType}" clo="uslq">
                                    ${!h?`<img class="no-photo" alt="Ảnh đại diện" >`:`<img class="lazyload" alt="${r.title}" data-src="${h}" >`}
                                    <div class="${n.GetStyleClass("text-content")}">
                                        <div class="${n.GetStyleClass("title")}">${n.FormartTagHtml(c.replace(/q&uot/g,'"').replace(/#&39/g,"'"))}</div>
                                        <div class="${n.GetStyleClass("time")}">${GetShowDurationTime(new Date(r.saveTime))}</div>
                                    </div>
                                </a>
                                <span class="${n.GetStyleClass("ic_save","itemUnSave")}" data-documentid="${r.documentId}" o-id="${r.oId||""}"></span>
                            </div>`)
                    }
                    $(`.${n.GetStyleClass("marked-products-popup")} .${n.GetStyleClass("content")} img`).on("error", function() {
                        $(this).attr("src", "https://staticfile.batdongsan.com.vn/images/mobile/NoImage.svg")
                    });
                    $(`.${n.GetStyleClass("marked-products-popup")} .${n.GetStyleClass("content")} .${n.GetStyleClass("item")}`).hover(function() {
                        var t = $(this).outerHeight() / 2 - 24;
                        $(this).find(`.${n.GetStyleClass("ic_save")}`).css({
                            display: "inline-block",
                            "margin-top": "" + t + "px"
                        })
                    }, function() {
                        $(this).find(`.${n.GetStyleClass("ic_save")}`).css("display", "none")
                    });
                    waitObject("styleServices").then(() => {
                        document.querySelectorAll(`.${window.styleServices.getStyleClass("itemUnSave")}`).forEach(t => {
                            t.addEventListener("click", function() {
                                var r = +t.getAttribute("data-documentid");
                                r && i.MarkOrUnmarkProduct({
                                    documentId: r
                                }).then(() => {
                                    $(`.${n.GetStyleClass("ic_save")}.${n.GetStyleClass("itemUnSave")}[data-documentId="${r}"]`).parent(`div.${n.GetStyleClass("item")}`).remove(), $(`[marked-product-info-as-json*=":${r},"]`).removeClass(n.GetStyleClass("pressed")), u(), i.GetMarkedProducts().then(t => {
                                        document.querySelectorAll(".js__marking-product").forEach(i => {
                                            var r = i.getAttribute("data-marked-product-info-as-json");
                                            r && JSON.parse(r) && JSON.parse(r).documentId && (t.filter(n => n.documentId == JSON.parse(r).documentId).length ? (i.classList.add(n.GetStyleClass("pressed")), i.parentElement.setAttribute("aria-label", "Bấm để bỏ lưu tin")) : (i.classList.remove(n.GetStyleClass("pressed")), i.parentElement.setAttribute("aria-label", "Bấm để lưu tin")))
                                        })
                                    })
                                })
                            })
                        })
                    })
                } else $(`.${n.GetStyleClass("marked-products-popup")} .${n.GetStyleClass("footer")}`).attr("style", "display: none !important;"), f.html(`
                        <p class="${n.GetStyleClass("center")}">
                            <img src="${$("#staticDomain").data("cssserver")+"/images/icons/marking/empty-state_wap_v1.svg"}" alt="no data">
                        </p>`)
            })
        }

        function u() {
            i.GetMarkedProducts().then(t => {
                var i = $("body").width();
                $(window).resize(function() {
                    i = $("body").width()
                });
                i > 1128 ? $(`#notiSave .${n.GetStyleClass("nqv")}`).length > 0 && ($(`#notiSave .${n.GetStyleClass("nqv")}`).html(t.length), t.length ? $(`#notiSave .${n.GetStyleClass("nqv")}`).show() : $(`#notiSave .${n.GetStyleClass("nqv")}`).hide()) : $(`#saveList .${n.GetStyleClass("notification")}`).length > 0 && ($(`#saveList .${n.GetStyleClass("notification")}`).html(t.length), t.length ? $(`#saveList .${n.GetStyleClass("notification")}`).removeClass(`${n.GetStyleClass("hide")}`) : $(`#saveList .${n.GetStyleClass("notification")}`).addClass(`${n.GetStyleClass("hide")}`))
            })
        }

        function s(t, i) {
            var u = $(`.${n.GetStyleClass("actived")}`).children("a").attr("href");
            if (u != null && u != "undefined" && u.includes("/du-an-bat-dong-san")) {
                t > r ? $(".text-new-content").removeClass("text-new-content-top") : $(".text-new-content").addClass("text-new-content-top");
                return
            }
            t >= i ? $(".text-new-content").removeClass("text-new-content-top") : $(".text-new-content").addClass("text-new-content-top")
        }

        function f(t, i, u) {
            var f = $(`.${n.GetStyleClass("actived")}`).children("a").attr("href");
            f != null && f != "undefined" && f.includes("/du-an-bat-dong-san") ? (i >= r ? $("header").addClass(`${n.GetStyleClass("remove-box-shadow")}`) : $("header").removeClass(`${n.GetStyleClass("remove-box-shadow")}`), t > 1128 && (i >= r ? $("header").addClass(`${n.GetStyleClass("fix")}`) : $("header").removeClass(`${n.GetStyleClass("fix")}`))) : i >= u ? ($("header").addClass(`${n.GetStyleClass("fix")}`), $(".js__bds-notification").length && $(".js__bds-notification").attr("size", "sm")) : ($("header").removeClass(`${n.GetStyleClass("fix")}`), $(".js__bds-notification").length && $(".js__bds-notification").attr("size", "md"))
        }

        function p() {
            var t = $(`.${n.GetStyleClass("actived")}`).children("a").attr("href"),
                r;
            if (t != null && t != "undefined" && t.includes("/du-an-bat-dong-san")) {
                if (r = $(`header.${n.GetStyleClass("full-menu")}.${n.GetStyleClass("header")}`).first(), window.location.pathname.includes("-pj")) {
                    var i = $(`div .${n.GetStyleClass("project-album-container")}`).first(),
                        f = $("div .js__project-navigation").first(),
                        u = i.position();
                    return u.top + i.outerHeight() - f.outerHeight() - r.outerHeight()
                }
                var i = $(`div .${n.GetStyleClass("project-main-left")}`).first(),
                    e = $("div .project-search-bar").first(),
                    u = i.position();
                return topMenuHeader = u.top - e.outerHeight() - 125
            }
            return 50
        }

        function h() {
            $(`#divUserStt .${window.styleServices.getStyleClass("notification")}`).removeClass(`${window.styleServices.getStyleClass("actived")}`);
            $("#notify_quick_view").remove();
            $(".text-name ul").hide();
            $(".quick_notify").addClass("hidden");
            $(".form-content").removeClass("under-login-popup")
        }

        function w(n) {
            var t, i, r;
            return n && (t = n.search("/crop/"), t >= 0 && (i = n.substring(0, t), r = n.substring(t + 14, n.length), n = i + "/crop/200x140/" + r)), n
        }
        var e = 3,
            i = new window.FrontEnd.MarkingProductsServices,
            n = new CommonJS.Common,
            r = p();
        $(window).on("resize", function() {
            var t, n, i;
            ResponsiveSizeScreen();
            window.location.pathname != "/" && $(".ui-autocomplete").addClass("custom-width");
            $(".ui-autocomplete").hide();
            t = $(window).scrollTop();
            n = window.innerWidth;
            n > 1128 && n <= 1135 ? (i = $(".box-header").outerHeight(), t > i ? $(".box-header").removeClass("fix").hide() : $(".box-header").removeClass("fix").show()) : n <= 1128 && $(".box-header").show()
        });
        return $(window).trigger("resize"), $(window).trigger("scroll"), {
            Initialize: c,
            ShowMarkedProductsPopup: a,
            UpdateMarkedProductsCount: u,
            ShowMarkedProductsNoti: v
        }
    }
})(menu);