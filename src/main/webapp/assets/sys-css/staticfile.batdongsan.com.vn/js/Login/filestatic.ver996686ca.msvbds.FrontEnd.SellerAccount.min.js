var cm = new CommonJS.Common,
    captcha = new CaptchaJS.CommonCaptcha,
    account = {};
(function(n) {
    n.Content = function() {
        function r(i) {
            $("#kct_login, #ico_register").click(function() {
                t(i.urlListLogin)
            });
            $("#kct_username, #ico_login").click(function() {
                t(i.urlListRegister)
            });
            $(document).on("click", "#closePopup", function() {
                n()
            });
            $(document).keyup(function(t) {
                t.key === "Escape" && n()
            });
            window.addEventListener("message", u, !1)
        }

        function u(t) {
            var r, i;
            try {
                r = t.data;
                r.length && r != undefined && (i = JSON.parse(r), i != null && i.action != null && (i.action.toLowerCase() == "signinsuccess" || i.action.toLowerCase() == "signupsuccess") && (n(!1), window.SegmentClient && window.SegmentClient.Identify(), window.location.reload(!0)))
            } catch (u) {
                return !1
            }
        }

        function t(n) {
            f();
            cm.AjaxWrapper({
                url: i + n,
                type: "GET",
                data: {},
                success: function(n) {
                    cm.DisableBodyScroll();
                    $("body").append(n);
                    $(".js__form-popup").css("position", "absolute");
                    $(".js__form-popup").css("top", $(window).height() / 2 - $(`.${cm.GetStyleClass("form-popup-content")}`).height() / 2 + window.scrollY);
                    $("#dialog-backdrop").show();
                    $(".bg-site").addClass("over-auto");
                    e()
                }
            })
        }

        function f() {
            $(".dialog-backdrop").append('<div id="fancybox-loading"><div><\/div><\/div>')
        }

        function e() {
            $("#fancybox-loading").remove()
        }

        function n(n) {
            if ($(".js__form-popup").remove(), $("#dialog-backdrop").hide(), $(".bg-site").removeClass("over-auto"), $("#top-bar").length && $("#top-bar").removeClass("hidden"), cm.EnableBodyScroll(), cm.RemoveEventLoading(), n != !1) {
                var t = 2;
                (function() {
                    --t;
                    window.userServices ? window.userServices.getCurrentUserInfo(function(n) {
                        n && window.location.reload(!0)
                    }) : t >= 0 && setTimeout(setUserService, 100)
                })()
            }
        }
        var i = $("#staticDomain").data("msvrouter") !== undefined ? $("#staticDomain").data("msvrouter") : "";
        return {
            Initialize: r,
            CloseAccountPopup: n
        }
    }
})(account);