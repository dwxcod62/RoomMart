var cm = new CommonJS.Common,
    newsLetterRegister = {};
(function(n) {
    n.NewsLetterRegister = function() {
        function h() {
            var t = 20;
            (function u() {
                --t;
                window.userServices ? window.userServices.getCurrentUserInfo(function(t) {
                    t != null && (r = t.mobile !== "" && t.mobile != undefined && t.mobile != null ? t.mobile : "", i = t.name !== "" && t.name != undefined && t.name != null ? t.name : "", n = t.email !== "" && t.email != undefined && t.email != null ? t.email : "")
                }) : t >= 0 && setTimeout(u, 100)
            })();
            $("#newsletterRegister").click(function() {
                n = $("#email").val();
                s(n, i, r)
            });
            $("#newsletterRegister-footer").click(function() {
                n = $("#email-footer").val();
                s(n, i, r)
            });
            $("#btnSend").click(function() {
                var n = $("#txtContent").val(),
                    t = $("#hdCate").val(),
                    i = $("#hdSubCate").val();
                n !== undefined && n !== "" ? (window.localStorage.setItem("FAQQuestion", n), window.localStorage.setItem("FAQCate", t), window.localStorage.setItem("FAQSubCate", i), window.location.href = "/dang-tin-hoi-dap") : (window.localStorage.removeItem("FAQQuestion"), window.localStorage.removeItem("FAQCate", t), window.localStorage.removeItem("FAQSubCate", i), alert("Bạn vui lòng nhập nội dung câu hỏi"))
            })
        }

        function c() {
            var i, t;
            n = $("#Email").val();
            i = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
            n !== undefined && n !== "" && i.test(n) && e(n);
            t = 20,
                function r() {
                    --t;
                    window.userServices ? window.userServices.getCurrentUserInfo(function(n) {
                        n && ($("#Email").val(n.email), $("#FullName").val(n.name), $("#Mobile").val(n.mobile), $("#Email").trigger("change"), $("#Mobile").trigger("change"))
                    }) : t >= 0 && setTimeout(r, 100)
                }()
        }

        function l() {
            $("#Email").blur(function() {
                cm.ValidateEmail($(this)) && (n = $(this).val(), e(n))
            });
            $("#Mobile").blur(function() {
                mobile = $(this).val().trim();
                mobile ? cm.ValidateMobile($(this)) : cm.RemoveErrorMessage($(this))
            })
        }

        function a(n, t, i) {
            var r, u = "OK",
                e;
            n ? t ? (r = `<div class="sending_img"><img src="${f}/images/contacts/sent.svg"></div>
                                <div class="sending_code">Cám ơn bạn!</div>
                                <div class="sending_msg">Chúng tôi đã gửi một email tới ${i} để xác thực địa chỉ email của bạn. Vui lòng kiểm tra và làm theo hướng dẫn để hoàn tất đăng ký.</div>`, u = "Tôi đã hiểu") : r = `<div class="sending_img"><img src="${f}/images/contacts/sent.svg"></div>
                                <div class="sending_code">Đăng ký thành công!</div>
                                <div class="sending_msg">Cảm ơn bạn đã đăng ký nhận email. Chúng tôi sẽ gửi thông tin cho bạn sớm nhất.</div>` : r = `<div class="sending_img"><img src="${f}/images/contacts/not-send.svg"></div>
                            <div class="sending_code">Rất tiếc!</div>
                            <div class="sending_msg">Đã có lỗi xảy ra, vui lòng thực hiện lại.</div>`;
            e = {
                classContent: `new2021 form-col-1 static`,
                classHeader: "modal-header",
                style: "static",
                title: `<div class="title"></div>`,
                content: r,
                width: 344,
                keepBodyScroll: !1,
                buttons: [{
                    text: u,
                    id: "btnCancel",
                    "class": cm.GetStyleClass("btn", "btn-pr-solid--md"),
                    eventHandle: function() {
                        cm.ModalEvent($("#dialogPopup"), "hide")
                    }
                }]
            };
            cm.ShowDialog(e);
            cm.RecenterModal()
        }

        function s(n, t, i) {
            var r = {
                classClose: "",
                classContent: `new2021 form-col-1`,
                classHeader: "modal-header",
                title: `<div class="title">Đăng ký nhận bản tin điện tử</div>`,
                width: 464,
                url: u + "/Systems/RegisterNewsLetter/Register",
                type: "GET",
                data: {
                    email: n,
                    name: t,
                    mobile: i
                }
            };
            cm.ShowDialog(r)
        }

        function v(n) {
            var i, r;
            t || (t = !0, i = !0, i = cm.ValidateEmail($("#Email")), i) && (r = "", $('input[name="news"]:checked').each(function() {
                r += this.value + ";"
            }), e($("#Email").val(), function() {
                cm.AjaxWrapperWithPromise({
                    type: "POST",
                    url: u + "/Systems/RegisterNewsLetter/Register",
                    data: {
                        email: $("#Email").val(),
                        mobile: $("#Mobile").val(),
                        fullname: $("#FullName").val(),
                        issms: $("#chkIsSms").is(":checked"),
                        cateids: r,
                        token: n
                    }
                }).then(function(n) {
                    t = !1;
                    a(n.isSuccess, n.isConfirm, $("#Email").val())
                })
            }, function() {
                t = !1
            }))
        }

        function e(n, t, i) {
            var r = {
                type: "GET",
                url: u + "/Systems/RegisterNewsLetter/IsDuplicateEmail",
                data: {
                    email: n
                },
                success: function(n) {
                    n === !0 ? (cm.AddErrorMessage($("#Email"), "Email này đã đăng ký nhận tin"), i && i()) : (cm.RemoveErrorMessage($("#Email")), t && t())
                }
            };
            cm.AjaxWrapper(r)
        }
        var i = "",
            r = "",
            n = "",
            u = "",
            o = "https://file4.batdongsan.com.vn",
            f = $("#staticDomain").data("cssserver"),
            y = JSON.parse($("script[info-params]").attr("info-params")),
            t;
        return o = $("#staticDomain").data("fileimg") !== undefined ? $("#staticDomain").data("fileimg") : o, u = $("#staticDomain").data("msvrouter") !== undefined ? $("#staticDomain").data("msvrouter") : "", t = !1, {
            InitializeLoad: h,
            Initialize: c,
            PopupRequired: l,
            SendRequest: function(n) {
                v(n)
            }
        }
    }
})(newsLetterRegister);